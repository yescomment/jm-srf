---
import '../styles/theme.css'

import { Icon } from 'astro-icon/components'

import { Button } from 'srf-theme-components';
import { BaseHtml, Header, Footer, config } from 'jm-srf-components';
import type { Props as BaseHeadProps } from '../components/head/BaseHead.astro';
import settings from '../config/settings';

import logoImpHoriPrimy from '@assets/logos/srf_impact_wordmark_horizontal_primary.svg';
import logoImpIconPrimy from '@assets/logos/srf_impact_brackets_primary.svg';
import logoImpStacWhite from '@assets/logos/srf_impact_wordmark_stacked_white.svg';

import logoCapHoriWhite from '@assets/logos/srf_capital_wordmark_horizontal_white.svg';
import logoCapIconWhite from '@assets/logos/srf_capital_brackets_white.svg';
import logoCapStacWhite from '@assets/logos/srf_capital_wordmark_stacked_white.svg';

export interface Props {
	seo?: BaseHeadProps;
}

const { seo } = Astro.props as Props;
const isHomePage = Astro.url.pathname === '/';
const sectionNavLinks = [
	{ href: '#thesis', label: 'Thesis' },
	{ href: '#approach', label: 'Approach' },
	{ href: '#ecosystem', label: 'Ecosystem' },
	{ href: '#institute', label: 'Institute' },
	{ href: '#focus-areas', label: 'Focus Areas' },
	{ href: '#contact', label: 'Contact' },
];
const pageNavLinks = [
	{ href: '/about', label: 'About' },
	{ href: '/areas-of-focus', label: 'Areas of Focus' },
	{ href: '/strategy', label: 'Strategy' },
	{ href: '/get-involved', label: 'Get Involved' },
	{ href: '/whealth-capital-project', label: 'The (W)Health Capital Project' },
];
const navLinks = isHomePage ? sectionNavLinks : pageNavLinks;
---
<BaseHtml seo={seo}>
	<Header slot="header">
		<img slot="logo-full" class="logo-full separator" src={logoImpHoriPrimy.src} alt="SRF Impact">
		<img slot="logo-icon" class="logo-icon" src={logoImpIconPrimy.src} alt="SRF Impact">
		<Fragment slot="main-nav-items">
			{
				navLinks.map((link) => (
					<a class={isHomePage ? 'section-tab' : undefined} href={link.href}>{link.label}</a>
				))
			}
		</Fragment>
	</Header>
	<div id="page">
		<slot />
		{
			isHomePage && (
				<script>
					const sectionLinks = Array.from(
						document.querySelectorAll('nav.main-nav > a.section-tab[href^="#"]'),
					);
					const sections = sectionLinks
						.map((link) => {
							const href = link.getAttribute('href');
							if (!href) return null;
							return document.getElementById(href.replace('#', ''));
						})
						.filter(Boolean);

					const setActiveSectionLink = (id) => {
						for (const link of sectionLinks) {
							const isActive = link.getAttribute('href') === `#${id}`;
							link.classList.toggle('is-active', isActive);
							if (isActive) link.setAttribute('aria-current', 'location');
							else link.removeAttribute('aria-current');
						}
					};

					const syncSectionNav = () => {
						if (!sections.length) return;

						const header = document.querySelector('header');
						const offset = (header?.getBoundingClientRect().height ?? 0) + 24;
						const position = window.scrollY + offset;

						let activeId = sections[0].id;
						for (const section of sections) {
							if (section.offsetTop <= position) activeId = section.id;
						}

						setActiveSectionLink(activeId);
					};

					window.addEventListener('scroll', syncSectionNav, { passive: true });
					window.addEventListener('resize', syncSectionNav);
					window.addEventListener('hashchange', syncSectionNav);
					syncSectionNav();
				</script>
			)
		}
	</div>
		<Footer>
			<img slot="logo" class="logo" src={logoImpStacWhite.src} alt="SRF Impact">

			{
				navLinks.map((link) => (
					<a slot="sitenav" href={link.href}>{link.label}</a>
				))
			}

			<a slot="contact" class="button" href="mailto:dorian@srfcapital.com">
				<Icon size="1.5em" name="material-symbols:mail-rounded" /> Contact
		</a>
	</Footer>
</BaseHtml>

<style is:global>
	nav > a.section-tab {
		transition: color 0.2s ease, background-color 0.2s ease;
	}

	nav > a.section-tab.is-active {
		color: var(--color-light);
		background-color: var(--color-primary);
	}
</style>
